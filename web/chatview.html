<html>

<body>
    <div id="messages">
    </div>
</body>


<!-- Uncomment for easy testing ->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!- -->

<style>

.message_sender {
    font-weight: bold;
}

.message_in > .message_sender {
    color: red;
}

.message_out > .message_sender {
    color: blue;
}

.message_timestamp {
    float: right;
    display: none;
}

.message:hover .message_timestamp {
    display: block;
}

.message_delivery_status {
    float:right;
}

</style>

<script>
var ring = {};

ring.chatview = (function(){

    function addMessage(message_object)
    {
        // Properties of the message object
        message_id = message_object["id"];
        message_text = message_object["text"];
        message_sender = message_object["sender"];
        message_timestamp = message_object["timestamp"];
        message_direction = message_object["direction"];
        message_delivery_status = message_object["delivery_status"];


        message_div_classes = [
            "message_" + message_direction,
        ]
        $message_div = $(
            "<div>",
            {
                id: "message_" + message_id,
                class: "message " + message_div_classes.join(" "),
            }
        );

        $message_text = $(
            "<span>",
            {
                class: "message_text",
                text: message_text,
            }
        );

        $message_sender = $(
            "<span>",
            {
                class: "message_sender",
                text: message_sender + ": ",
            }
        );

        $message_delivery_status = $(
            "<span>",
            {
                class: "message_delivery_status",
                text: message_delivery_status,
            }
        )

        $message_time = $(
            "<span>",
            {
                class: "message_timestamp",
                text: message_timestamp,
            }
        )

        $message_div.append($message_sender);
        $message_div.append($message_text);
        $message_div.append($message_delivery_status);
        $message_div.append($message_time);

        $("#messages").append($message_div);
    }

    function updateMessage(message_object)
    {
        // Properties of the message object
        message_id = message_object["id"];
        message_text = message_object["text"];
        message_sender = message_object["sender"];
        message_timestamp = message_object["timestamp"];
        message_direction = message_object["direction"];
        message_delivery_status = message_object["delivery_status"];

        message_selector = "#message_" + message_id;

        $(message_selector + " .message_text").text(message_text);
        $(message_selector + " .message_sender").text(message_sender);
        $(message_selector + " .message_timestamp").text(message_timestamp);
        $(message_selector + " .message_delivery_status").text(message_delivery_status);
    }

    return {
        addMessage: addMessage,
        updateMessage: updateMessage,
    }

})();

/* Uncomment for easy testing *
ring.chatview.addMessage("Added message 1", "author1", 11, "in");
ring.chatview.addMessage("Added message 2", "author2", 11, "out");
ring.chatview.addMessage("Added message 3", "author1", 11, "in");
/* */
</script>

</html>
